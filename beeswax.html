<!DOCTYPE html>
<html>
  <head>
    <title>Beeswax Alpha</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script type="text/javascript" src="http://github.com/notmasteryet/audiodata/raw/master/audiodata.js"></script>
    <script type="text/javascript" src="../KievII/utilities/Utilities.js"></script>
    <script type="text/javascript" src="../KievII/graphic_elements/Element.js"></script>
    <script type="text/javascript" src="../KievII/graphic_elements/UI.js"></script>
    <script type="text/javascript" src="../KievII/graphic_elements/Background.js"></script>
    <script type="text/javascript" src="../KievII/graphic_elements/Button.js"></script>
    <script type="text/javascript" src="../KievII/graphic_elements/RotKnob.js"></script>
    <script type="text/javascript" src="../KievII/graphic_elements/wrappers/CanvasDraw.js"></script>
    <script type="text/javascript" src="../KievII/graphic_elements/wrappers/Wrappers.js"></script>
    <script type="text/javascript" src="audio/bw_process.js"></script>
    <script type="text/javascript" src="audio/ADBeeswax.js"></script>
  </head>
  <body>
    <canvas id="plugin" width="963" height="613"></canvas>
    <script type="text/javascript">

        // This should fix "console not defined" problem.
        if (typeof console=="undefined"){console={log:function(A){var B=false;if(B){alert(A)}}}}

        /* INIT */
        var plugin_canvas = document.getElementById("plugin");
        var CWrapper = K2WRAPPER.createWrapper("CANVAS_WRAPPER",
                                                    {canvas: plugin_canvas}
                                                    );
        var ui = new UI (plugin_canvas, CWrapper);

        var notes_array = ["C", "Cs", "D", "Ds", "E", "F", "Fs", "G", "Gs", "A", "As", "B"],
            colors_array = ["Red", "Yellow", "Green"],
            imageResources = [];

        var mulArgs = { multipleImages: [],
                        onComplete: afterLoading
        }

        // Load keys

        for (i = 0; i < notes_array.length; i += 1) {
            imageResources = ["Keys/" + notes_array[i] + "_inactive.png", "Keys/" + notes_array[i] + "_active.png"];
            mulArgs.multipleImages.push ({ID: notes_array[i] + "_loader", imageNames : imageResources});
        }
        
        // Load colored lights
        
        for (i = 0; i < colors_array.length; i += 1) {
            imageResources = ["Lights/" + colors_array[i] + "_inactive.png", "Lights/" + colors_array[i] + "_active.png"];
            mulArgs.multipleImages.push ({ID: colors_array[i] + "_loader", imageNames : imageResources});
        }

        // Load bg
        mulArgs.multipleImages.push ({ID: "background_loader", imageNames : ["Beeswax_deck.png"]});
                     
        var mImageLoader = new loadMultipleImages (mulArgs);

        function afterLoading (loaders) {
      
            var key_initial_offset = 68,
                light_initial_offset = 162,
                background,
                keys = [],
                knob = [],
                lights = {
                    Red: "",
                    Yellow: "",
                    Green: ""
                };
            
            
            /* BACKGROUND */
            
            var backgroundArgs = {
                ID: 'background',
                top: 0,
                left: 0,
                image: loaders["background_loader"].images[0],
                preserveBg: true
                }
            background = new Background (backgroundArgs);
            
            ui.addElement(background, {zIndex: 1});

            /* KEYS */

            var keyArgs = {
                /*ID: "note",*/
                left:  0,
                top: 405,
                preserveBg: true,
                isClickable: true
            };

            keyArgs.onValueSet = function () {
                var that = this;
                return function (slot, value, ID) {
                    var note = ID;
                    if (value === 0) {
                        /*this.*///ADBeesWax.noteOff (ID);
                        console.log ("Calling ADBeesWax.noteOff with value " + ID);
                    }
                    else if (value === 1) {
                        /*this.*///ADBeesWax.noteOn (ID);
                        console.log ("Calling ADBeesWax.noteOn with value " + ID);
                    }
                    else {
                        //throw!
                    }
                };
            }();

            for (var i = 0; i < notes_array.length; i += 1) {
                keyArgs.ID = i;
                keyArgs.imagesArray = loaders[notes_array[i] + "_loader"].images,
                keyArgs.left = key_initial_offset + i * 73;
                keys[i] = new Button(keyArgs);
                ui.addElement(keys[i], {zIndex: 5});
            }
            
            // LIGHTS
            
            var lightArgs = {
                left:  0,
                top: 252,
                preserveBg: true,
                isClickable: true,
            };
            
            for (var i = 0; i < colors_array.length; i += 1) {
                lightArgs.ID = colors_array[i];
                lightArgs.imagesArray = loaders[colors_array[i] + "_loader"].images,
                lightArgs.left = light_initial_offset + i * 72;
                lightArgs.ROILeft = 74 + lightArgs.left;
                lightArgs.ROITop = 78 + lightArgs.top;
                lightArgs.ROIWidth = 22;
                lightArgs.ROIHeight = 22;
                lights[colors_array[i]] = new Button(lightArgs);
                // Lights overlap at the same z-index: they need a complete repaint
                ui.addElement(lights[colors_array[i]], {zIndex: 3, completeRepaint: true});
            }
            
            /*keyArgs.onValueSet = function () {
                var that = this;
                return function (slot, value) {
                    if (value === 0) {
                        ADBeesWax.setBypass (false);
                        console.log ("Setting bypass to false");
                    }
                    else if (value === 1) {
                        ADBeesWax.setBypass (true);
                        console.log ("Setting bypass to true");
                    }
                };
            }();*/

            /*buttonArgs.ID = "bypass";
            buttonArgs.left = 500;
            var bypassButton = new Button(buttonArgs);
            ui.addElement(bypassButton);*/

            /* KNOBS */

            /*var knob_names  = ["Cutoff","Resonance","Feedback","Volume"];

            var knobArgs = {
                //ID:
                top: 200,
                left: 0,
                image : loaders["knob_img_loader"].images[0],
                sensivity : 5000,
                isClickable: true
            };

            knobArgs.onValueSet = function () {
                var that = this;
                return function (slot, value, ID) {
                    var knobname = slot;
                    // Interpolate the knob value in the integer range [0,127]
                    var interpolated_value = Math.round(value * 127);
                    var functionName = "set" + ID;
                    console.log ("Calling ADBeesWax[" + functionName + "] with value " + value + "-->" + interpolated_value);
                    ADBeesWax[functionName](interpolated_value);
                    
                };
            }();

            for (var i = 0; i < knob_names.length; i ++) {
                knobArgs.ID = knob_names[i];
                knobArgs.left = i * 200;
                knob[i] = new RotKnob(knobArgs);
                ui.addElement(knob[i]);
            }

            //debugger;
            var ADBeesWax = new AudioDataBeeswax();
            ADBeesWax.init({sampleRate: 44100}); */

            ui.refresh();

        }


    </script>
  </body>
</html>
